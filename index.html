<div id="exam-timer-top"></div>
<div id="exam-timer-bottom"></div>

<script>
(function(){
  let startTime = null;
  let intervalId = null;

  const displays = [
    document.getElementById("exam-timer-top"),
    document.getElementById("exam-timer-bottom")
  ];

  function renderControls(display) {
    display.innerHTML = `
      <div style="font-family:sans-serif;text-align:center;margin:10px;">
        <div class="time" style="font-size:24px;margin-bottom:5px;">00:00:00</div>
        <button class="start">Start</button>
        <button class="stop" disabled>Stop</button>
        <button class="reset" disabled>Reset</button>
      </div>`;
  }

  displays.forEach(renderControls);

  function updateDisplays(elapsed) {
    let h = String(Math.floor(elapsed / 3600000)).padStart(2,"0");
    let m = String(Math.floor((elapsed % 3600000) / 60000)).padStart(2,"0");
    let s = String(Math.floor((elapsed % 60000) / 1000)).padStart(2,"0");
    displays.forEach(d => {
      d.querySelector(".time").textContent = `${h}:${m}:${s}`;
    });
  }

  function startTimer() {
    if (intervalId) return;
    startTime = Date.now();
    intervalId = setInterval(()=>{
      updateDisplays(Date.now()-startTime);
    },500);
    toggleButtons(true);
  }

  function stopTimer() {
    if (!intervalId) return;
    clearInterval(intervalId); intervalId=null;
    updateDisplays(Date.now()-startTime);
    toggleButtons(false);
  }

  function resetTimer() {
    startTime = null;
    updateDisplays(0);
  }

  function toggleButtons(isRunning){
    displays.forEach(d=>{
      d.querySelector(".start").disabled = isRunning;
      d.querySelector(".stop").disabled = !isRunning;
      d.querySelector(".reset").disabled = false;
    });
  }

  // Hook up events
  displays.forEach(d=>{
    d.querySelector(".start").addEventListener("click",startTimer);
    d.querySelector(".stop").addEventListener("click",stopTimer);
    d.querySelector(".reset").addEventListener("click",resetTimer);
  });

  updateDisplays(0);
})();
</script>

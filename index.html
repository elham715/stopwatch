<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Exam Stopwatch</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 10px;
    }
    .time {
      font-size: 32px;
      margin-bottom: 10px;
    }
    button {
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="time">00:00:00</div>
  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>
  <button id="reset" disabled>Reset</button>

  <script>
    let intervalId = null;

    // Restore state from localStorage
    function getState() {
      const raw = localStorage.getItem("examStopwatch");
      return raw ? JSON.parse(raw) : { running:false, startTime:null, elapsed:0 };
    }

    function saveState(state) {
      localStorage.setItem("examStopwatch", JSON.stringify(state));
    }

    function elapsedTime(state) {
      if (state.running) {
        return (Date.now() - state.startTime) + state.elapsed;
      } 
      return state.elapsed;
    }

    function format(ms) {
      let h = String(Math.floor(ms/3600000)).padStart(2,"0");
      let m = String(Math.floor((ms%3600000)/60000)).padStart(2,"0");
      let s = String(Math.floor((ms%60000)/1000)).padStart(2,"0");
      return `${h}:${m}:${s}`;
    }

    function render() {
      let state = getState();
      document.querySelector(".time").textContent = format(elapsedTime(state));
      document.getElementById("start").disabled = state.running;
      document.getElementById("stop").disabled = !state.running;
      document.getElementById("reset").disabled = state.elapsed === 0 && !state.running;
    }

    function tick() {
      render();
    }

    function start() {
      let state = getState();
      if (!state.running) {
        state.running = true;
        state.startTime = Date.now();
        saveState(state);
        render();
      }
    }

    function stop() {
      let state = getState();
      if (state.running) {
        state.elapsed = elapsedTime(state);
        state.running = false;
        saveState(state);
        render();
      }
    }

    function reset() {
      saveState({ running:false, startTime:null, elapsed:0 });
      render();
    }

    // Events
    document.getElementById("start").onclick = start;
    document.getElementById("stop").onclick = stop;
    document.getElementById("reset").onclick = reset;

    // Keep refreshing display
    setInterval(tick, 500);

    // Sync between tabs/embeds (using storage event)
    window.addEventListener("storage", render);

    // Initial render
    render();
  </script>
</body>
</html>
